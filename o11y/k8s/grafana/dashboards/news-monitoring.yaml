apiVersion: v1
kind: ConfigMap
metadata:
  name: gd-news-monitoring
  namespace: o11y
  labels:
    grafana_dashboard: '1'
    app: grafana
data:
  news-monitoring.json: '{"timezone":"utc","editable":true,"graphTooltip":0,"fiscalYearStartMonth":0,"schemaVersion":41,"templating":{"list":[{"type":"datasource","name":"LOKI_DATASOURCE","skipUrlSync":false,"multi":false,"allowCustomValue":true,"includeAll":false,"auto":false,"auto_min":"10s","auto_count":30,"query":"loki"}]},"annotations":{},"title":"freeCodeCamp News Dashboard (Gantry)","uid":"freecodecamp-news-v1","tags":["News","Docker","Loki"],"description":"Monitor automated news service updates via Gantry (runs hourly at :45)","refresh":"15m","time":{"from":"now-2d","to":"now"},"panels":[{"type":"stat","transparent":false,"repeatDirection":"h","title":"Total Log Lines","description":"Total Gantry log activity in selected range","gridPos":{"x":0,"y":0,"w":6,"h":5},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"sum(count_over_time({stack=\"oncall\", service=\"update\"} [$__range]))","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"}}],"fieldConfig":{"defaults":{"unit":"short","thresholds":{"mode":"absolute","steps":[{"color":"blue","value":0}]}},"overrides":[]},"options":{"graphMode":"area","colorMode":"value","justifyMode":"auto","textMode":"value_and_name","wideLayout":true,"showPercentChange":false,"reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"percentChangeColorMode":"standard","orientation":"auto","text":{"valueSize":32,"titleSize":12}}},{"type":"stat","transparent":false,"repeatDirection":"h","title":"Service Updates","description":"Number of service update operations in selected range","gridPos":{"x":6,"y":0,"w":6,"h":5},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"sum(count_over_time({stack=\"oncall\", service=\"update\"} |~ \"(?i)updating\" [$__range]))","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"}}],"fieldConfig":{"defaults":{"unit":"short","thresholds":{"mode":"absolute","steps":[{"color":"green","value":0}]}},"overrides":[]},"options":{"graphMode":"area","colorMode":"value","justifyMode":"auto","textMode":"value_and_name","wideLayout":true,"showPercentChange":false,"reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"percentChangeColorMode":"standard","orientation":"auto","text":{"valueSize":32,"titleSize":12}}},{"type":"stat","transparent":false,"repeatDirection":"h","title":"Successes","description":"Successful update operations","gridPos":{"x":12,"y":0,"w":6,"h":5},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"sum(count_over_time({stack=\"oncall\", service=\"update\"} |~ \"(?i)updated\" [$__range]))","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"}}],"fieldConfig":{"defaults":{"unit":"short","thresholds":{"mode":"absolute","steps":[{"color":"green","value":0}]}},"overrides":[]},"options":{"graphMode":"none","colorMode":"value","justifyMode":"auto","textMode":"value_and_name","wideLayout":true,"showPercentChange":false,"reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"percentChangeColorMode":"standard","orientation":"auto","text":{"valueSize":32,"titleSize":12}}},{"type":"stat","transparent":false,"repeatDirection":"h","title":"Failures & Rollbacks","description":"Failed updates and rollback events","gridPos":{"x":18,"y":0,"w":6,"h":5},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"sum(count_over_time({stack=\"oncall\", service=\"update\"} |~ \"(?i)(fail|error|rollback)\" [$__range])) or vector(0)","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"}}],"fieldConfig":{"defaults":{"unit":"short","thresholds":{"mode":"absolute","steps":[{"color":"green","value":0},{"color":"yellow","value":1},{"color":"red","value":5}]}},"overrides":[]},"options":{"graphMode":"none","colorMode":"value","justifyMode":"auto","textMode":"value_and_name","wideLayout":true,"showPercentChange":false,"reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"percentChangeColorMode":"standard","orientation":"auto","text":{"valueSize":32,"titleSize":12}}},{"type":"stat","transparent":false,"repeatDirection":"h","title":"Chinese","description":"Update activity for svc-chn","gridPos":{"x":0,"y":5,"w":3,"h":4},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"sum(count_over_time({stack=\"oncall\", service=\"update\"} |~ \"(?i)svc-chn\" [$__range]))","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"}}],"fieldConfig":{"defaults":{"unit":"short","thresholds":{"mode":"absolute","steps":[{"color":"red","value":0},{"color":"yellow","value":1},{"color":"green","value":3}]}},"overrides":[]},"options":{"graphMode":"area","colorMode":"value","justifyMode":"auto","textMode":"value_and_name","wideLayout":true,"showPercentChange":false,"reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"percentChangeColorMode":"standard","orientation":"auto","text":{"valueSize":20}}},{"type":"stat","transparent":false,"repeatDirection":"h","title":"Espa√±ol","description":"Update activity for svc-esp","gridPos":{"x":3,"y":5,"w":3,"h":4},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"sum(count_over_time({stack=\"oncall\", service=\"update\"} |~ \"(?i)svc-esp\" [$__range]))","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"}}],"fieldConfig":{"defaults":{"unit":"short","thresholds":{"mode":"absolute","steps":[{"color":"red","value":0},{"color":"yellow","value":1},{"color":"green","value":3}]}},"overrides":[]},"options":{"graphMode":"area","colorMode":"value","justifyMode":"auto","textMode":"value_and_name","wideLayout":true,"showPercentChange":false,"reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"percentChangeColorMode":"standard","orientation":"auto","text":{"valueSize":20}}},{"type":"stat","transparent":false,"repeatDirection":"h","title":"Italian","description":"Update activity for svc-ita","gridPos":{"x":6,"y":5,"w":3,"h":4},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"sum(count_over_time({stack=\"oncall\", service=\"update\"} |~ \"(?i)svc-ita\" [$__range]))","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"}}],"fieldConfig":{"defaults":{"unit":"short","thresholds":{"mode":"absolute","steps":[{"color":"red","value":0},{"color":"yellow","value":1},{"color":"green","value":3}]}},"overrides":[]},"options":{"graphMode":"area","colorMode":"value","justifyMode":"auto","textMode":"value_and_name","wideLayout":true,"showPercentChange":false,"reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"percentChangeColorMode":"standard","orientation":"auto","text":{"valueSize":20}}},{"type":"stat","transparent":false,"repeatDirection":"h","title":"Japanese","description":"Update activity for svc-jpn","gridPos":{"x":9,"y":5,"w":3,"h":4},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"sum(count_over_time({stack=\"oncall\", service=\"update\"} |~ \"(?i)svc-jpn\" [$__range]))","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"}}],"fieldConfig":{"defaults":{"unit":"short","thresholds":{"mode":"absolute","steps":[{"color":"red","value":0},{"color":"yellow","value":1},{"color":"green","value":3}]}},"overrides":[]},"options":{"graphMode":"area","colorMode":"value","justifyMode":"auto","textMode":"value_and_name","wideLayout":true,"showPercentChange":false,"reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"percentChangeColorMode":"standard","orientation":"auto","text":{"valueSize":20}}},{"type":"stat","transparent":false,"repeatDirection":"h","title":"Korean","description":"Update activity for svc-kor","gridPos":{"x":12,"y":5,"w":3,"h":4},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"sum(count_over_time({stack=\"oncall\", service=\"update\"} |~ \"(?i)svc-kor\" [$__range]))","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"}}],"fieldConfig":{"defaults":{"unit":"short","thresholds":{"mode":"absolute","steps":[{"color":"red","value":0},{"color":"yellow","value":1},{"color":"green","value":3}]}},"overrides":[]},"options":{"graphMode":"area","colorMode":"value","justifyMode":"auto","textMode":"value_and_name","wideLayout":true,"showPercentChange":false,"reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"percentChangeColorMode":"standard","orientation":"auto","text":{"valueSize":20}}},{"type":"stat","transparent":false,"repeatDirection":"h","title":"Portuguese","description":"Update activity for svc-por","gridPos":{"x":15,"y":5,"w":3,"h":4},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"sum(count_over_time({stack=\"oncall\", service=\"update\"} |~ \"(?i)svc-por\" [$__range]))","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"}}],"fieldConfig":{"defaults":{"unit":"short","thresholds":{"mode":"absolute","steps":[{"color":"red","value":0},{"color":"yellow","value":1},{"color":"green","value":3}]}},"overrides":[]},"options":{"graphMode":"area","colorMode":"value","justifyMode":"auto","textMode":"value_and_name","wideLayout":true,"showPercentChange":false,"reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"percentChangeColorMode":"standard","orientation":"auto","text":{"valueSize":20}}},{"type":"stat","transparent":false,"repeatDirection":"h","title":"Ukrainian","description":"Update activity for svc-ukr","gridPos":{"x":18,"y":5,"w":3,"h":4},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"sum(count_over_time({stack=\"oncall\", service=\"update\"} |~ \"(?i)svc-ukr\" [$__range]))","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"}}],"fieldConfig":{"defaults":{"unit":"short","thresholds":{"mode":"absolute","steps":[{"color":"red","value":0},{"color":"yellow","value":1},{"color":"green","value":3}]}},"overrides":[]},"options":{"graphMode":"area","colorMode":"value","justifyMode":"auto","textMode":"value_and_name","wideLayout":true,"showPercentChange":false,"reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"percentChangeColorMode":"standard","orientation":"auto","text":{"valueSize":20}}},{"type":"stat","transparent":false,"repeatDirection":"h","title":"Total Services","description":"Services tracked","gridPos":{"x":21,"y":5,"w":3,"h":4},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"vector(7)","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"}}],"fieldConfig":{"defaults":{"unit":"short","thresholds":{"mode":"absolute","steps":[{"color":"blue","value":0}]}},"overrides":[]},"options":{"graphMode":"none","colorMode":"value","justifyMode":"auto","textMode":"value","wideLayout":true,"showPercentChange":false,"reduceOptions":{"calcs":["lastNotNull"],"values":false,"fields":""},"percentChangeColorMode":"standard","orientation":"auto","text":{"valueSize":24}}},{"type":"timeseries","transparent":false,"repeatDirection":"h","title":"Updates by Service Name (Extracted from Logs)","description":"Which news services are being updated","gridPos":{"x":0,"y":9,"w":24,"h":8},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"sum by (svc) (count_over_time({stack=\"oncall\", service=\"update\"} | regexp `svc-(?P<svc>\\w+)` [$__interval]))","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"legendFormat":"{{svc}}"}],"fieldConfig":{"defaults":{"unit":"short"},"overrides":[]},"options":{"legend":{"displayMode":"list","placement":"bottom","showLegend":true,"calcs":[]},"tooltip":{"mode":"multi","sort":"none"}}},{"type":"timeseries","transparent":false,"repeatDirection":"h","title":"Update Operations Over Time","description":"Count of update operations (updating, updated, failed, rollback)","gridPos":{"x":0,"y":17,"w":12,"h":8},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"sum(count_over_time({stack=\"oncall\", service=\"update\"} |~ \"(?i)(updating service)\" [$__interval]))","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"legendFormat":"Starting Update"},{"expr":"sum(count_over_time({stack=\"oncall\", service=\"update\"} |~ \"(?i)(updated service|update succeed)\" [$__interval]))","refId":"B","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"legendFormat":"Success"},{"expr":"sum(count_over_time({stack=\"oncall\", service=\"update\"} |~ \"(?i)(fail|error)\" [$__interval]))","refId":"C","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"legendFormat":"Failed"},{"expr":"sum(count_over_time({stack=\"oncall\", service=\"update\"} |~ \"(?i)(rollback)\" [$__interval]))","refId":"D","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"legendFormat":"Rollback"}],"fieldConfig":{"defaults":{"unit":"short"},"overrides":[{"matcher":{"id":"byName","options":"Starting Update"},"properties":[{"id":"color","value":{"mode":"fixed","fixedColor":"blue"}}]},{"matcher":{"id":"byName","options":"Success"},"properties":[{"id":"color","value":{"mode":"fixed","fixedColor":"green"}}]},{"matcher":{"id":"byName","options":"Failed"},"properties":[{"id":"color","value":{"mode":"fixed","fixedColor":"red"}}]},{"matcher":{"id":"byName","options":"Rollback"},"properties":[{"id":"color","value":{"mode":"fixed","fixedColor":"orange"}}]}]},"options":{"legend":{"displayMode":"list","placement":"bottom","showLegend":true,"calcs":[]},"tooltip":{"mode":"multi","sort":"none"}}},{"type":"timeseries","transparent":false,"repeatDirection":"h","title":"Updates by News Service","description":"Which news services are being updated most frequently","gridPos":{"x":12,"y":17,"w":12,"h":8},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"sum by (svc) (count_over_time({stack=\"oncall\", service=\"update\"} | regexp `prd-news_svc-(?P<svc>\\w+)` [$__interval]))","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"legendFormat":"{{svc}}"}],"fieldConfig":{"defaults":{"unit":"short"},"overrides":[]},"options":{"legend":{"displayMode":"list","placement":"bottom","showLegend":true,"calcs":[]},"tooltip":{"mode":"multi","sort":"none"}}},{"type":"logs","transparent":false,"repeatDirection":"h","title":"Failures & Rollbacks (Problems Only)","description":"Showing only failed updates and rollback events","gridPos":{"x":0,"y":25,"w":24,"h":10},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"{stack=\"oncall\", service=\"update\"} |~ \"(?i)(fail|rollback|roll back|exception)\" != \"0 error\" !~ \"PARSE RATE ERROR\"","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"maxLines":5000}],"options":{"showLabels":true,"showCommonLabels":false,"showTime":true,"showLogContextToggle":false,"wrapLogMessage":true,"prettifyLogMessage":false,"enableLogDetails":true,"sortOrder":"Descending","dedupStrategy":"none"}},{"type":"logs","transparent":false,"repeatDirection":"h","title":"Logs","description":"Filtered logs showing service update operations","gridPos":{"x":0,"y":35,"w":24,"h":12},"datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"targets":[{"expr":"{stack=\"oncall\", service=\"update\"}","refId":"A","datasource":{"type":"loki","uid":"ff42fx0hl5qtcd"},"maxLines":5000}],"options":{"showLabels":false,"showCommonLabels":false,"showTime":true,"showLogContextToggle":false,"wrapLogMessage":false,"prettifyLogMessage":false,"enableLogDetails":true,"sortOrder":"Descending","dedupStrategy":"none"}}]}'
